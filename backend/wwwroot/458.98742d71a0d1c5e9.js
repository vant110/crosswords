"use strict";(self.webpackChunkcrosswords=self.webpackChunkcrosswords||[]).push([[458],{3458:(q,_,l)=>{l.r(_),l.d(_,{UserCrosswordsModule:()=>k});var C=l(6895),b=l(655),w=l(9933),x=l(1135),v=l(3900),M=l(9646),P=l(9300),O=l(7404),t=l(4650),A=l(5384),F=l(3910),a=l(433),S=l(4457),z=l(8e3),T=l(5635),p=l(7724),y=l(6616),Z=l(7044),U=l(1664),$=l(826);function J(e,n){if(1&e&&t._UZ(0,"nz-option",8),2&e){const o=n.$implicit;t.Q6J("nzLabel",o.name)("nzValue",o.id)}}function I(e,n){if(1&e&&t._UZ(0,"nz-option",8),2&e){const o=n.$implicit;t.Q6J("nzLabel",o.name)("nzValue",o.id)}}function L(e,n){if(1&e&&(t.TgZ(0,"nz-select",9),t.YNc(1,I,1,2,"nz-option",2),t.qZA()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.crosswordTypeOptions)}}function N(e,n){if(1&e&&t._UZ(0,"nz-option",8),2&e){const o=n.$implicit;t.Q6J("nzLabel",o.name)("nzValue",o.id)}}function Q(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(o);const i=t.oxw(2);return t.KtG(i.onTakePrompt())}),t._uU(1),t.qZA()}if(2&e){const o=n.ngIf,s=t.oxw(2);t.Q6J("disabled",!s.isCellSelected||o.promptCount<=0),t.xp6(1),t.hij(" \u0412\u0437\u044f\u0442\u044c \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0443 (",o.promptCount,") ")}}function E(e,n){if(1&e&&(t.TgZ(0,"section",10)(1,"h2"),t._uU(2,"\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434\u044b"),t.qZA(),t.TgZ(3,"nz-select",11),t.YNc(4,N,1,2,"nz-option",2),t.ALo(5,"async"),t.qZA(),t.YNc(6,Q,2,2,"button",12),t.ALo(7,"async"),t.qZA()),2&e){const o=t.oxw();t.Q6J("formGroup",o.crosswordsForm),t.xp6(4),t.Q6J("ngForOf",t.lcZ(5,3,o.crosswords$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,5,o.selectedCrossword$))}}function D(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"input",20),t.NdJ("ngModelChange",function(i){t.CHM(o);const r=t.oxw().index,c=t.oxw().index,d=t.oxw(2);return t.KtG(d.onLetterChange(i,c,r))}),t.qZA()}if(2&e){const o=t.oxw(),s=o.index,i=o.$implicit,r=t.oxw().index,c=t.oxw(2);t.Q6J("disabled",c.solvedMatrix[r][s])("ngModel",i)}}function B(e,n){if(1&e){const o=t.EpF();t.TgZ(0,"td",18),t.NdJ("click",function(){const i=t.CHM(o),r=i.index,c=i.$implicit,d=t.oxw().index,u=t.oxw(2);return t.KtG(u.onLetterClick(d,r,c))}),t.YNc(1,D,1,2,"input",19),t.qZA()}if(2&e){const o=n.$implicit,s=n.index,i=t.oxw().index,r=t.oxw(2);t.ekj("potentian-letter",void 0!==o)("selected",i===(null==r.selectedCell?null:r.selectedCell.y)&&s===(null==r.selectedCell?null:r.selectedCell.x)),t.xp6(1),t.Q6J("ngIf",void 0!==o)}}function Y(e,n){if(1&e&&(t.TgZ(0,"tr"),t.YNc(1,B,2,5,"td",17),t.qZA()),2&e){const o=n.$implicit;t.xp6(1),t.Q6J("ngForOf",o)}}function W(e,n){if(1&e&&(t.TgZ(0,"nz-table",14,15),t.ALo(2,"crosswordWidth"),t.TgZ(3,"tbody"),t.YNc(4,Y,2,1,"tr",16),t.qZA()()),2&e){const o=n.ngIf,s=t.MAs(1);t.Udp("width",t.lcZ(2,6,o),"px"),t.Q6J("nzData",o)("nzShowPagination",!1)("nzFrontPagination",!1),t.xp6(4),t.Q6J("ngForOf",s.data)}}function V(e,n){if(1&e&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA()()),2&e){const o=n.$implicit,s=t.oxw(2);t.xp6(1),t.ekj("selected-definition",-1!==s.selectedWordsIds.indexOf(o.id)),t.xp6(1),t.hij(" ",o.definition," ")}}const G=function(){return{y:"300px"}};function H(e,n){if(1&e&&(t.TgZ(0,"nz-table",21,22)(2,"thead")(3,"tr")(4,"th"),t._uU(5,"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435"),t.qZA()()(),t.TgZ(6,"tbody"),t.YNc(7,V,3,3,"tr",16),t.qZA()()),2&e){const o=n.ngIf,s=t.MAs(1);t.Q6J("nzData",o.words)("nzScroll",t.DdM(5,G))("nzShowPagination",!1)("nzFrontPagination",!1),t.xp6(7),t.Q6J("ngForOf",s.data)}}var g=(()=>{return(e=g||(g={})).UNSTARTED="unstarted",e.STARTED="started",g;var e})();let f=class{constructor(n,o,s,i){this.api=n,this.modal=o,this.formBuilder=s,this.notify=i,this.themes$=new x.X([]),this.filterForm=this.formBuilder.group({theme:[0],crosswordType:[g.STARTED]}),this.crosswordTypeOptions=[{id:g.STARTED,name:"\u041d\u0430\u0447\u0430\u0442\u044b\u0435"},{id:g.UNSTARTED,name:"\u041d\u0435\u043d\u0430\u0447\u0430\u0442\u044b\u0435"}],this.crosswords$=new x.X([]),this.crosswordsForm=this.formBuilder.group({crossword:[0]}),this.selectedCrossword$=new x.X(null),this.crosswordMatrix$=new x.X([[]]),this.solvedMatrix=[],this.selectedCell=null,this.selectedWordsIds=[],this.filterForm.valueChanges.pipe((0,w.t)(this)).subscribe(r=>{!r.crosswordType||!r.theme||(this.updateCrosswordsList(r.theme,r.crosswordType),this.deselectCrossword())}),this.crosswordsForm.get("crossword")?.valueChanges.pipe((0,w.t)(this),(0,v.w)(r=>r?this.selectedCrosswordType===g.STARTED?this.api.getStartedCrossword(r):this.api.getUnstartedCrossword(r):(0,M.of)(null)),(0,P.h)(r=>!!r)).subscribe(r=>this.selectedCrossword$.next(r)),this.selectedCrossword$.pipe((0,w.t)(this)).subscribe(r=>{!r||this.updateCrossword(r.size.height,r.size.width,r.words,r.grid)}),this.updateThemes()}get selectedThemeId(){return this.filterForm.get("theme")?.value}get selectedCrosswordId(){return this.crosswordsForm.get("crossword")?.value}get selectedCrosswordType(){return this.filterForm.get("crosswordType")?.value}get filtersPresent(){return!!this.filterForm.get("theme")?.value&&!!this.filterForm.get("crosswordType")?.value}get isCellSelected(){return Number.isInteger(this.selectedCell?.x)&&Number.isInteger(this.selectedCell?.y)}ngOnInit(){}updateCrossword(n,o,s,i=[]){const r=[],c=[];for(let d=0;d<n;d++)r[d]=new Array(o),c[d]=new Array(o);for(const d of s){if(d.p1.x!==d.p2.x)for(let u=0;u<=d.p2.x-d.p1.x;u++){const h=d.p1.y,m=d.p1.x+u;r[h][m]="",d.isSolved&&(c[h][m]=!0)}if(d.p1.y!==d.p2.y)for(let u=0;u<=d.p2.y-d.p1.y;u++){const h=d.p1.y+u,m=d.p1.x;r[h][m]="",d.isSolved&&(c[h][m]=!0)}}if(i.length)for(const d of i)r[d.y][d.x]=d.l;this.solvedMatrix=c,this.crosswordMatrix$.next(r)}onTakePrompt(){const n=this.selectedCell?.x,o=this.selectedCell?.y;this.api.takePrompt(this.selectedCrosswordId,n,o).subscribe(s=>{this.selectedCrossword$.value&&this.selectedCrossword$.value.promptCount--,this.crosswordMatrix$.value[o][n]=s.letter,s.solvedWords?.length&&this.applySolvedWords(s.solvedWords)},s=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",s.error.message)})}onLetterClick(n,o,s){if(void 0===s)return;this.selectedCell={x:o,y:n};const i=this.selectedCrossword$.value;!i||(this.selectedWordsIds=(0,O.z)(i?.words,o,n).map(r=>r.id))}onLetterChange(n,o,s){this.api.changeLetter(this.selectedCrosswordId,s,o,n).subscribe(r=>{!r.solvedWords?.length||this.applySolvedWords(r.solvedWords)},r=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",r.error.message)})}applySolvedWords(n){for(const o of n){const s=this.selectedCrossword$.value?.words.find(i=>i.id===o.id);if(s){if(s.p1.x!==s.p2.x)for(let i=0;i<=s.p2.x-s.p1.x;i++)this.solvedMatrix[s.p1.y][s.p1.x+i]=!0;if(s.p1.y!==s.p2.y)for(let i=0;i<=s.p2.y-s.p1.y;i++)this.solvedMatrix[s.p1.y+i][s.p1.x]=!0}}}updateThemes(){this.api.getThemes().subscribe(n=>this.themes$.next(n))}updateCrosswordsList(n,o){(o===g.STARTED?this.api.getStartedCrosswordList(n):this.api.getUnstartedCrosswordList(n)).subscribe(i=>this.crosswords$.next(i))}deselectCrossword(){this.selectedCell=null,this.crosswordsForm.get("crossword")?.setValue(null,{emitEvent:!1}),this.selectedCrossword$.next(null),this.crosswordMatrix$.next([[]])}};f.\u0275fac=function(n){return new(n||f)(t.Y36(A.s),t.Y36(F.Sf),t.Y36(a.qu),t.Y36(S.zb))},f.\u0275cmp=t.Xpm({type:f,selectors:[["app-user-crosswords"]],decls:11,vars:12,consts:[[1,"themes",3,"formGroup"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0435\u043c\u0443","formControlName","theme"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043f \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434\u0430","formControlName","crosswordType",4,"ngIf"],["class","crossword-header",3,"formGroup",4,"ngIf"],[1,"crossword-content"],["class","crossword-table","nzBordered","","nzTableLayout","fixed","nzSize","small",3,"width","nzData","nzShowPagination","nzFrontPagination",4,"ngIf"],["class","definition-table",3,"nzData","nzScroll","nzShowPagination","nzFrontPagination",4,"ngIf"],[3,"nzLabel","nzValue"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043f \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434\u0430","formControlName","crosswordType"],[1,"crossword-header",3,"formGroup"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434","formControlName","crossword"],["nz-button","","nzType","primary",3,"disabled","click",4,"ngIf"],["nz-button","","nzType","primary",3,"disabled","click"],["nzBordered","","nzTableLayout","fixed","nzSize","small",1,"crossword-table",3,"nzData","nzShowPagination","nzFrontPagination"],["crosswordTable",""],[4,"ngFor","ngForOf"],["nzAlign","center",3,"potentian-letter","selected","click",4,"ngFor","ngForOf"],["nzAlign","center",3,"click"],["type","text","maxlength","1","nz-input","","nzBorderless","","nzSize","small",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["type","text","maxlength","1","nz-input","","nzBorderless","","nzSize","small",3,"disabled","ngModel","ngModelChange"],[1,"definition-table",3,"nzData","nzScroll","nzShowPagination","nzFrontPagination"],["definitionsTable",""]],template:function(n,o){1&n&&(t.TgZ(0,"section",0)(1,"nz-select",1),t.YNc(2,J,1,2,"nz-option",2),t.ALo(3,"async"),t.qZA(),t.YNc(4,L,2,1,"nz-select",3),t.qZA(),t.YNc(5,E,8,7,"section",4),t.TgZ(6,"section",5),t.YNc(7,W,5,8,"nz-table",6),t.ALo(8,"async"),t.YNc(9,H,8,6,"nz-table",7),t.ALo(10,"async"),t.qZA()),2&n&&(t.Q6J("formGroup",o.filterForm),t.xp6(2),t.Q6J("ngForOf",t.lcZ(3,6,o.themes$)),t.xp6(2),t.Q6J("ngIf",o.selectedThemeId),t.xp6(1),t.Q6J("ngIf",o.filtersPresent),t.xp6(2),t.Q6J("ngIf",t.lcZ(8,8,o.crosswordMatrix$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(10,10,o.selectedCrossword$)))},dependencies:[C.sg,C.O5,z.Ip,z.Vq,a.Fj,a.JJ,a.JL,a.nD,a.sg,a.u,a.On,T.Zp,p.N8,p.Uo,p._C,p.Om,p.p0,p.$Z,p.UX,y.ix,Z.w,U.dQ,C.Ov,$.a],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.themes[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}nz-select[_ngcontent-%COMP%]{width:220px}.crossword-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:16px}.crossword-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.crossword-header[_ngcontent-%COMP%]   nz-input-group[_ngcontent-%COMP%]{width:166px}.crossword-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:auto}.crossword-content[_ngcontent-%COMP%]{overflow:auto;margin-top:16px}.crossword-content[_ngcontent-%COMP%]   nz-table.crossword-table[_ngcontent-%COMP%]{margin-bottom:16px}.crossword-content[_ngcontent-%COMP%]   nz-table.crossword-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px;height:31px;border:none;border-collapse:collapse}.crossword-content[_ngcontent-%COMP%]   nz-table.crossword-table[_ngcontent-%COMP%]   td.potentian-letter[_ngcontent-%COMP%]{border:1px solid rgb(104,104,104);background-color:#f0f0f0}.crossword-content[_ngcontent-%COMP%]   nz-table.crossword-table[_ngcontent-%COMP%]   td.potentian-letter.selected[_ngcontent-%COMP%]{background-color:#4aa8ff}.crossword-content[_ngcontent-%COMP%]   nz-table.crossword-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0;text-align:center;text-transform:uppercase}.crossword-content[_ngcontent-%COMP%]   nz-table.definition-table[_ngcontent-%COMP%]   td.selected-definition[_ngcontent-%COMP%]{background-color:#4aa8ff}"]}),f=(0,b.gn)([(0,w.c)()],f);var j=l(8176),R=l(1102),X=l(9444);const K=[{path:"",component:f}];let k=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.ez,j.Bz.forChild(K),z.LV,R.PV,a.UX,a.u5,T.o7,p.HQ,y.sL,X.D]}),e})()}}]);