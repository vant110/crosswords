"use strict";(self.webpackChunkcrosswords=self.webpackChunkcrosswords||[]).push([[229],{229:(S,T,a)=>{a.r(T),a.d(T,{AdminDictionariesModule:()=>L});var f=a(6895),z=a(655),d=a(9933),_=a(1135),x=a(8372),b=a(9300),w=a(8505),O=a(3900),A=a(2652),r=a(433),t=a(4650),y=a(3910),C=a(1102),m=a(5635);function Z(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"label",3)(1,"input",4),t.NdJ("change",function(s){t.CHM(e);const c=t.oxw();return t.KtG(c.upload(s))}),t.qZA(),t._UZ(2,"span",5),t._uU(3," Upload "),t.qZA()}}let l=class{constructor(n,e){this.formBuilder=n,this.modalRef=e,this.isEdit=!1,this.fileName=null,this.form=this.formBuilder.group({file:[null],name:["",[r.kI.required]]}),this.form.statusChanges.pipe((0,d.t)(this)).subscribe(i=>{this.modalRef.updateConfig({nzOkDisabled:!("VALID"===i)})})}set name(n){!n||this.form.get("name")?.setValue(n)}upload(n){this.file=n.target.files?.[0],this.fileName=this.file?.name,this.form.patchValue({file:this.file,name:this.fileName})}};function v(o,n){1&o&&t._UZ(0,"input",3)}l.\u0275fac=function(n){return new(n||l)(t.Y36(r.qu),t.Y36(y.Lf))},l.\u0275cmp=t.Xpm({type:l,selectors:[["app-dictionary-add"]],inputs:{isEdit:"isEdit",name:"name"},decls:3,vars:2,consts:[[3,"formGroup"],["nz-input","","placeholder","\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044f","formControlName","name"],["class","upload-button","for","file",4,"ngIf"],["for","file",1,"upload-button"],["id","file","name","file","type","file","hidden","","accept",".txt",3,"change"],["nz-icon","","nzType","upload","nzTheme","outline"]],template:function(n,e){1&n&&(t.ynx(0,0),t._UZ(1,"input",1),t.YNc(2,Z,4,0,"label",2),t.BQk()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(2),t.Q6J("ngIf",!e.isEdit))},dependencies:[f.O5,C.Ls,m.Zp,r.Fj,r.JJ,r.JL,r.sg,r.u],styles:["[_nghost-%COMP%]{display:flex;gap:16px}.upload-button[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid rgb(77,76,76);border-radius:2px;padding:4px 16px;cursor:pointer}.upload-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px;margin-right:8px}.upload-button[_ngcontent-%COMP%]:hover{border-color:#1890ff}"]}),l=(0,z.gn)([(0,d.c)()],l);let u=class{constructor(n,e){this.formBuilder=n,this.modalRef=e,this.isEdit=!1,this.form=this.formBuilder.group({word:["",[r.kI.required,r.kI.minLength(3)]],definition:["",[r.kI.required,r.kI.minLength(10)]]}),this.form.statusChanges.pipe((0,d.t)(this)).subscribe(i=>{this.modalRef.updateConfig({nzOkDisabled:!("VALID"===i)})})}set word(n){!n||this.form.setValue({word:n.name,definition:n.definition})}};u.\u0275fac=function(n){return new(n||u)(t.Y36(r.qu),t.Y36(y.Lf))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-word-add"]],inputs:{isEdit:"isEdit",word:"word"},decls:3,vars:2,consts:[[3,"formGroup"],["nz-input","","placeholder","\u0421\u043b\u043e\u0432\u043e","formControlName","word",4,"ngIf"],["nz-input","","placeholder","\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435","nzAutosize","","formControlName","definition"],["nz-input","","placeholder","\u0421\u043b\u043e\u0432\u043e","formControlName","word"]],template:function(n,e){1&n&&(t.ynx(0,0),t.YNc(1,v,1,0,"input",1),t._UZ(2,"textarea",2),t.BQk()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("ngIf",!e.isEdit))},dependencies:[f.O5,m.Zp,m.rh,r.Fj,r.JJ,r.JL,r.sg,r.u],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}"]}),u=(0,z.gn)([(0,d.c)()],u);var k=a(5384),P=a(4457),D=a(8e3),p=a(7724);const F=["wordsTable"];function W(o,n){if(1&o&&t._UZ(0,"nz-option",14),2&o){const e=n.$implicit;t.Q6J("nzLabel",e.name)("nzValue",e.id)}}function M(o,n){1&o&&t._UZ(0,"span",15)}function E(o,n){if(1&o&&t._UZ(0,"nz-option",14),2&o){const e=n.$implicit;t.Q6J("nzLabel",e.name)("nzValue",e.id)}}function J(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",20),t.NdJ("click",function(){const c=t.CHM(e).$implicit,g=t.oxw(2);return t.KtG(g.onRowClick(c.id))}),t.TgZ(1,"td",18),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA()()}if(2&o){const e=n.$implicit,i=t.oxw(2);t.ekj("selected",i.selectedRow===e.id),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.definition)}}const B=function(){return{y:"560px"}};function I(o,n){if(1&o&&(t.TgZ(0,"nz-table",16,17)(2,"thead")(3,"tr")(4,"th",18),t._uU(5,"\u0421\u043b\u043e\u0432\u043e"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435"),t.qZA()()(),t.TgZ(8,"tbody"),t.YNc(9,J,5,4,"ng-template",19),t.qZA()()),2&o){const e=n.ngIf,i=t.oxw();t.Q6J("nzData",e)("nzFrontPagination",!1)("nzScroll",t.DdM(5,B))("nzVirtualItemSize",25)("nzVirtualForTrackBy",i.trackByIndex)}}let h=class{constructor(n,e,i,s){this.api=n,this.modal=e,this.formBuilder=i,this.notify=s,this.words$=new _.X([]),this.dictionaries$=new _.X([]),this.dictionariesForm=this.formBuilder.group({dictionary:[null]}),this.wordsForm=this.formBuilder.group({search:[null],sort:[A.k.ASC_APLHABET]}),this.sortOptions=A.b,this.selectedRow=-1,this._gridIndex=0,this._gridLoading=!1,this.updateDictionaries(),this.dictionariesForm.get("dictionary")?.valueChanges.pipe((0,d.t)(this)).subscribe(c=>{this.updateWords(c)}),this.wordsForm.valueChanges.pipe((0,d.t)(this),(0,x.b)(500)).subscribe(c=>{this.api.getWords(this.selectedDictionary,c.sort,c.search).subscribe(Q=>{this.nzTableComponent?.cdkVirtualScrollViewport?.scrollToIndex(0),this.words$.next(Q)})})}get selectedDictionary(){return this.dictionariesForm.get("dictionary")?.value}ngAfterViewInit(){this.nzTableComponent?.cdkVirtualScrollViewport?.scrolledIndexChange.pipe((0,d.t)(this),(0,b.h)(n=>{this._gridIndex=n;const e=this.words$.value.length;return n>e-25&&e>=25&&!this._gridLoading}),(0,w.b)(()=>this._gridLoading=!0),(0,O.w)(()=>{const n=this.wordsForm.value;return this.api.getWords(this.selectedDictionary,n.sort,n.search,this.words$.value[this.words$.value.length-1].name)})).subscribe(n=>{this._gridLoading=!1,this.words$.next([...this.words$.value,...n])})}updateDictionaries(){this.api.getDictionaries().subscribe(n=>this.dictionaries$.next(n))}updateWords(n){const e=this.wordsForm.value;this.api.getWords(n,e.sort,e.search).subscribe(c=>this.words$.next(c))}onAddDictionary(){this.modal.create({nzContent:l,nzTitle:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043b\u043e\u0432\u0430\u0440\u044c",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:n=>this.createDictionary(n)})}createDictionary(n){return new Promise(e=>{const i=n.form.value,s=new FormData;s.append("name",i.name),n.file&&s.append("dictionary",n.file),this.api.createDictionary(s).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u0421\u043b\u043e\u0432\u0430\u0440\u044c ${i.name} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d`),this.updateDictionaries(),e(!0)},c=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",c.error.message),e(!0)})})}onEditDictionary(){if(!this.selectedDictionary)return;const n=this.dictionaries$.value.find(e=>e.id===this.selectedDictionary)?.name;this.modal.create({nzContent:l,nzComponentParams:{isEdit:!0,name:n},nzTitle:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u043e\u0432\u0430\u0440\u044c",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:e=>this.editDictionary(e)})}editDictionary(n){return new Promise(e=>{const i=n.form.value.name;this.api.editDictionary(this.selectedDictionary,i).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u0421\u043b\u043e\u0432\u0430\u0440\u044c ${i} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d`),this.updateDictionaries(),e(!0)},c=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",c.error.message),e(!0)})})}onDeleteDictionary(){!this.selectedDictionary||this.api.deleteDictionary(this.selectedDictionary).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u0421\u043b\u043e\u0432\u0430\u0440\u044c \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d"),this.updateDictionaries(),this.dictionariesForm.get("dictionary")?.setValue(null)},n=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",n.error.message)})}onAddWord(){!this.selectedRow||this.modal.create({nzContent:u,nzTitle:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043b\u043e\u0432\u043e",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:n=>this.createWord(n)})}createWord(n){return new Promise(e=>{const i=n.form.value;this.api.createWord(this.selectedDictionary,i.word,i.definition).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u0421\u043b\u043e\u0432\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u043e"),this.updateWords(this.selectedDictionary),e(!0)},s=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",s.error.message),e(!0)})})}onEditWord(){if(!this.selectedRow)return;const n=this.words$.value.find(e=>e.id===this.selectedRow);this.modal.create({nzContent:u,nzComponentParams:{isEdit:!0,word:n},nzTitle:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u043b\u043e\u0432\u043e",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:e=>this.editWord(e)})}editWord(n){return new Promise(e=>{this.api.editWord(this.selectedRow,n.form.value.definition).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u0421\u043b\u043e\u0432\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e"),this.updateWords(this.selectedDictionary),e(!0)},s=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",s.error.message),e(!0)})})}onDeleteWord(){this.api.deleteWord(this.selectedRow).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u0421\u043b\u043e\u0432\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u043e"),this.updateWords(this.selectedDictionary)},n=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",n.error.message)})}onRowClick(n){this.selectedRow=n}trackByIndex(n,e){return e.id}};h.\u0275fac=function(n){return new(n||h)(t.Y36(k.s),t.Y36(y.Sf),t.Y36(r.qu),t.Y36(P.zb))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-admin-dictionaries"]],viewQuery:function(n,e){if(1&n&&t.Gf(F,5),2&n){let i;t.iGM(i=t.CRH())&&(e.nzTableComponent=i.first)}},decls:23,vars:10,consts:[[1,"dictionaries",3,"formGroup"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044c","formControlName","dictionary"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-icon","","nzType","file-add","nzTheme","outline",3,"click"],["nz-icon","","nzType","edit","nzTheme","outline",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline",1,"delete",3,"click"],[1,"words-header",3,"formGroup"],[1,"subsection"],[3,"nzPrefix"],["nz-input","","placeholder","\u041f\u043e\u0438\u0441\u043a","formControlName","search"],["suffixIconSearch",""],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443","formControlName","sort",1,"word-sort"],["nz-icon","","nzType","plus","nzTheme","outline",3,"click"],[3,"nzData","nzFrontPagination","nzScroll","nzVirtualItemSize","nzVirtualForTrackBy",4,"ngIf"],[3,"nzLabel","nzValue"],["nz-icon","","nzType","search",1,"search"],[3,"nzData","nzFrontPagination","nzScroll","nzVirtualItemSize","nzVirtualForTrackBy"],["wordsTable",""],["nzWidth","220px"],["nz-virtual-scroll",""],[3,"click"]],template:function(n,e){if(1&n&&(t.TgZ(0,"section",0)(1,"nz-select",1),t.YNc(2,W,1,2,"nz-option",2),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"span",3),t.NdJ("click",function(){return e.onAddDictionary()}),t.qZA(),t.TgZ(5,"span",4),t.NdJ("click",function(){return e.onEditDictionary()}),t.qZA(),t.TgZ(6,"span",5),t.NdJ("click",function(){return e.onDeleteDictionary()}),t.qZA()(),t.TgZ(7,"section",6)(8,"div",7)(9,"h2"),t._uU(10,"\u0421\u043b\u043e\u0432\u0430"),t.qZA(),t.TgZ(11,"nz-input-group",8),t._UZ(12,"input",9),t.qZA(),t.YNc(13,M,1,0,"ng-template",null,10,t.W1O),t.TgZ(15,"nz-select",11),t.YNc(16,E,1,2,"nz-option",2),t.qZA()(),t.TgZ(17,"div",7)(18,"span",12),t.NdJ("click",function(){return e.onAddWord()}),t.qZA(),t.TgZ(19,"span",4),t.NdJ("click",function(){return e.onEditWord()}),t.qZA(),t.TgZ(20,"span",5),t.NdJ("click",function(){return e.onDeleteWord()}),t.qZA()()(),t.YNc(21,I,10,6,"nz-table",13),t.ALo(22,"async")),2&n){const i=t.MAs(14);t.Q6J("formGroup",e.dictionariesForm),t.xp6(2),t.Q6J("ngForOf",t.lcZ(3,6,e.dictionaries$)),t.xp6(5),t.Q6J("formGroup",e.wordsForm),t.xp6(4),t.Q6J("nzPrefix",i),t.xp6(5),t.Q6J("ngForOf",e.sortOptions),t.xp6(5),t.Q6J("ngIf",t.lcZ(22,8,e.words$))}},dependencies:[f.sg,f.O5,D.Ip,D.Vq,C.Ls,r.Fj,r.JJ,r.JL,r.sg,r.u,m.Zp,m.gB,m.ke,p.N8,p.Uo,p._C,p.Om,p.p0,p.$Z,p.zu,f.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}nz-select[_ngcontent-%COMP%]{width:166px}nz-select.word-sort[_ngcontent-%COMP%]{width:200px}.dictionaries[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}span[nz-icon][_ngcontent-%COMP%]{font-size:24px;color:var(--cw-gray);cursor:pointer;transition:all .3s}span[nz-icon].search[_ngcontent-%COMP%]{font-size:16px;pointer-events:none}span[nz-icon].delete[_ngcontent-%COMP%]:hover{color:red}span[nz-icon][_ngcontent-%COMP%]:hover{color:var(--cw-primary)}.words-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-top:16px;margin-bottom:32px}.words-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.words-header[_ngcontent-%COMP%]   nz-input-group[_ngcontent-%COMP%]{width:166px}.words-header[_ngcontent-%COMP%]   .subsection[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}tr.selected[_ngcontent-%COMP%]{background-color:#b9dfdf!important}"]}),h=(0,z.gn)([(0,d.c)()],h);var N=a(8176);const V=[{path:"",component:h}];let L=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[f.ez,N.Bz.forChild(V),D.LV,C.PV,r.UX,r.u5,m.o7,p.HQ]}),o})()}}]);