"use strict";(self.webpackChunkcrosswords=self.webpackChunkcrosswords||[]).push([[707],{3707:(ue,y,l)=>{l.r(y),l.d(y,{AdminCrosswordsModule:()=>le});var f=l(6895),x=l(655),u=l(9933),z=l(1135),A=l(3900),O=l(8372),P=l(4004),I=l(9300),k=l(8505),b=l(2652),F=l(7404),d=l(433),e=l(4650),T=l(3910),g=l(5635),w=l(8e3),$=l(7096);function J(r,n){if(1&r&&e._UZ(0,"nz-option",9),2&r){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.id)}}function S(r,n){if(1&r&&e._UZ(0,"nz-option",9),2&r){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.id)}}function E(r,n){if(1&r&&e._UZ(0,"nz-input-number",10),2&r){const t=e.oxw();e.Q6J("nzMin",0)("nzMax",t.maxPromptCount)("nzStep",1)}}let p=class{constructor(n,t){this.formBuilder=n,this.modalRef=t,this.themes=[],this.dictionaries=[],this.crossword=null,this.form=this.formBuilder.group({name:["",[d.kI.required,d.kI.maxLength(30)]],themeId:[-1,[d.kI.required]],dictionaryId:[-1,[d.kI.required]],size:this.formBuilder.group({width:[10,[d.kI.required,d.kI.min(10),d.kI.max(20)]],height:[10,[d.kI.required,d.kI.min(10),d.kI.max(20)]]}),promptCount:[0,[d.kI.required]]}),this.maxPromptCount=0,this.form.statusChanges.pipe((0,u.t)(this)).subscribe(s=>{this.modalRef.updateConfig({nzOkDisabled:!("VALID"===s)})})}ngOnInit(){if(!this.crossword)return;this.form.patchValue(this.crossword);const n=this.crossword.words.reduce((t,s)=>t+s.name.length,0);this.maxPromptCount=Math.round(.1*n)}};p.\u0275fac=function(n){return new(n||p)(e.Y36(d.qu),e.Y36(T.Lf))},p.\u0275cmp=e.Xpm({type:p,selectors:[["app-crossword-add"]],inputs:{themes:"themes",dictionaries:"dictionaries",crossword:"crossword"},decls:12,vars:10,consts:[[3,"formGroup"],["nz-input","","placeholder","\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","formControlName","name"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0435\u043c\u0443","formControlName","themeId"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043b\u043e\u0432\u0430\u0440\u044c","formControlName","dictionaryId"],["formGroupName","size",1,"dimensions"],["formControlName","width","nzPlaceHolder","\u0428\u0438\u0440\u0438\u043d\u0430",3,"nzMin","nzMax","nzStep"],["formControlName","height","nzPlaceHolder","\u0412\u044b\u0441\u043e\u0442\u0430",3,"nzMin","nzMax","nzStep"],["formControlName","promptCount","nzPlaceHolder","\u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0438",3,"nzMin","nzMax","nzStep",4,"ngIf"],[3,"nzLabel","nzValue"],["formControlName","promptCount","nzPlaceHolder","\u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0438",3,"nzMin","nzMax","nzStep"]],template:function(n,t){1&n&&(e.ynx(0,0),e._UZ(1,"input",1),e.TgZ(2,"nz-select",2),e.YNc(3,J,1,2,"nz-option",3),e.qZA(),e.TgZ(4,"nz-select",4),e.YNc(5,S,1,2,"nz-option",3),e.qZA(),e.TgZ(6,"div",5),e._UZ(7,"nz-input-number",6),e.TgZ(8,"span"),e._uU(9,"X"),e.qZA(),e._UZ(10,"nz-input-number",7),e.qZA(),e.YNc(11,E,1,3,"nz-input-number",8),e.BQk()),2&n&&(e.Q6J("formGroup",t.form),e.xp6(3),e.Q6J("ngForOf",t.themes),e.xp6(2),e.Q6J("ngForOf",t.dictionaries),e.xp6(2),e.Q6J("nzMin",10)("nzMax",20)("nzStep",1),e.xp6(3),e.Q6J("nzMin",10)("nzMax",20)("nzStep",1),e.xp6(1),e.Q6J("ngIf",t.crossword))},dependencies:[f.sg,f.O5,g.Zp,d.Fj,d.JJ,d.JL,d.sg,d.u,d.x0,w.Ip,w.Vq,$._V],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}.dimensions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.dimensions[_ngcontent-%COMP%]   nz-input-number[_ngcontent-%COMP%]{width:60px}"]}),p=(0,x.gn)([(0,u.c)()],p);let h=class{constructor(n,t){this.formBuilder=n,this.modalRef=t,this.form=this.formBuilder.group({name:["",[d.kI.required]]}),this.form.statusChanges.pipe((0,u.t)(this)).subscribe(s=>{this.modalRef.updateConfig({nzOkDisabled:!("VALID"===s)})})}set theme(n){!n||this.form.setValue({name:n.name})}};h.\u0275fac=function(n){return new(n||h)(e.Y36(d.qu),e.Y36(T.Lf))},h.\u0275cmp=e.Xpm({type:h,selectors:[["app-theme-add"]],inputs:{theme:"theme"},decls:2,vars:1,consts:[[3,"formGroup"],["nz-input","","placeholder","\u0422\u0435\u043c\u0430","formControlName","name"]],template:function(n,t){1&n&&(e.ynx(0,0),e._UZ(1,"input",1),e.BQk()),2&n&&e.Q6J("formGroup",t.form)},dependencies:[g.Zp,d.Fj,d.JJ,d.JL,d.sg,d.u],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:16px}"]}),h=(0,x.gn)([(0,u.c)()],h);var L=l(5384),N=l(4457),Z=l(1102),m=l(7724),v=l(6616),B=l(7044),D=l(1664),Q=l(826);let U=(()=>{class r{transform([t,s],o,i){let a=!1;return null!==o.x&&null!==o.y&&null!==i.x&&null!==i.y&&(o.x===i.x&&o.x===s&&(a=t>=o.y&&t<=i.y||t<=o.y&&t>=i.y),o.y===i.y&&o.y===t&&(a=s>=o.x&&s<=i.x||s<=o.x&&s>=i.x)),t===o.y&&s===o.x||a}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275pipe=e.Yjl({name:"isSelected",type:r,pure:!0}),r})();const V=["availableWordsTable"];function W(r,n){if(1&r&&e._UZ(0,"nz-option",21),2&r){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.id)}}function Y(r,n){if(1&r&&e._UZ(0,"nz-option",21),2&r){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.id)}}function q(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"section",22)(1,"div",23)(2,"h2"),e._uU(3,"\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434\u044b"),e.qZA(),e.TgZ(4,"nz-select",24),e.YNc(5,Y,1,2,"nz-option",2),e.ALo(6,"async"),e.qZA()(),e.TgZ(7,"div",23)(8,"span",25),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onAddCrossword())}),e.qZA(),e.TgZ(9,"span",4),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onEditCrossword())}),e.qZA(),e.TgZ(10,"span",5),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onDeleteCrosword())}),e.qZA()()()}if(2&r){const t=e.oxw();e.Q6J("formGroup",t.crosswordsForm),e.xp6(5),e.Q6J("ngForOf",e.lcZ(6,2,t.crosswords$))}}function G(r,n){if(1&r&&(e.TgZ(0,"p"),e._uU(1," \u0421\u043b\u043e\u0432\u0430\u0440\u044c: "),e.TgZ(2,"span"),e._uU(3),e.qZA()()),2&r){const t=n.ngIf;e.xp6(3),e.Oqu(t)}}function H(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"section",26),e.YNc(1,G,4,1,"p",27),e.ALo(2,"async"),e.TgZ(3,"p"),e._uU(4," \u0420\u0430\u0437\u043c\u0435\u0440: "),e.TgZ(5,"span"),e._uU(6),e.qZA()(),e.TgZ(7,"p"),e._uU(8," \u041f\u043e\u0434\u0441\u043a\u0430\u0437\u043e\u043a: "),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",28)(12,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onGenerateCrossword())}),e._uU(13," \u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c "),e.qZA(),e.TgZ(14,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onSaveCrossword())}),e._uU(15," \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c "),e.qZA()()()}if(2&r){const t=n.ngIf,s=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,4,s.crosswordDictionaryName$)),e.xp6(5),e.AsE("",t.size.width," x ",t.size.height,""),e.xp6(4),e.Oqu(t.promptCount)}}const X=function(r,n){return[r,n]};function j(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"td",34),e.NdJ("click",function(){const i=e.CHM(t).index,c=e.oxw().index,a=e.oxw(2);return e.KtG(a.cellClick(c,i))})("dblclick",function(){const i=e.CHM(t).index,c=e.oxw().index,a=e.oxw(2);return e.KtG(a.cellDoubleclick(c,i))}),e.ALo(1,"isSelected"),e._uU(2),e.qZA()}if(2&r){const t=n.$implicit,s=n.index,o=e.oxw().index,i=e.oxw(2);e.ekj("selected",e.Dn7(1,5,e.WLB(9,X,o,s),i.selectedCell,i.selectedEndCell))("selected-potential",o===i.selectedCell.y||s===i.selectedCell.x),e.xp6(2),e.hij(" ",t," ")}}function K(r,n){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,j,3,12,"td",33),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function R(r,n){if(1&r&&(e.TgZ(0,"nz-table",31,32),e.ALo(2,"crosswordWidth"),e.TgZ(3,"tbody"),e.YNc(4,K,2,1,"tr",20),e.qZA()()),2&r){const t=n.ngIf,s=e.MAs(1);e.Udp("width",e.lcZ(2,6,t),"px"),e.Q6J("nzData",t)("nzShowPagination",!1)("nzFrontPagination",!1),e.xp6(4),e.Q6J("ngForOf",s.data)}}function ee(r,n){1&r&&e._UZ(0,"span",35)}function te(r,n){if(1&r&&e._UZ(0,"nz-option",21),2&r){const t=n.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t.id)}}function ne(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",39),e.NdJ("click",function(){const i=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onAvailableWordClick(i))}),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()}if(2&r){const t=n.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.definition)}}const M=function(){return{y:"300px"}};function se(r,n){if(1&r&&(e.TgZ(0,"nz-table",36,37)(2,"thead")(3,"tr")(4,"th",19),e._uU(5,"\u0421\u043b\u043e\u0432\u043e"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435"),e.qZA()()(),e.TgZ(8,"tbody"),e.YNc(9,ne,5,2,"ng-template",38),e.qZA()()),2&r){const t=n.ngIf,s=e.oxw();e.Q6J("nzData",t)("nzFrontPagination",!1)("nzScroll",e.DdM(5,M))("nzVirtualItemSize",25)("nzVirtualForTrackBy",s.trackByIndex)}}function oe(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&r){const t=n.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.definition)}}let C=class{constructor(n,t,s,o){this.api=n,this.modal=t,this.formBuilder=s,this.notify=o,this.themes$=new z.X([]),this.themesForm=this.formBuilder.group({theme:[null]}),this.crosswords$=new z.X([]),this.crosswordsForm=this.formBuilder.group({crossword:[null]}),this.selectedCrossword$=new z.X(null),this.crosswordMatrix$=new z.X([[]]),this.selectedCell={x:null,y:null},this.selectedEndCell={x:null,y:null},this.availableWords$=new z.X([]),this.wordsForm=this.formBuilder.group({search:[""],sort:[b.k.ASC_APLHABET],mask:[""]}),this.sortOptions=b.b,this._words=[],this._gridLoading=!1,this.themesForm.get("theme")?.valueChanges.pipe((0,u.t)(this)).subscribe(i=>{this.updateCrosswordsList(i),this.deselectCrossword()}),this.crosswordsForm.get("crossword")?.valueChanges.pipe((0,u.t)(this),(0,A.w)(i=>this.api.getCrossword(i))).subscribe(i=>this.selectedCrossword$.next(i)),this.selectedCrossword$.pipe((0,u.t)(this)).subscribe(i=>{!i||this.updateCrossword(i.size.height,i.size.width,i.words)}),this.wordsForm.valueChanges.pipe((0,u.t)(this),(0,O.b)(500)).subscribe(i=>{const ce=this.selectedCrossword$.value?.dictionaryId;this.api.getAvailableWords(ce,i.sort,i.search,i.mask).subscribe(ae=>{this.nzTableComponent?.cdkVirtualScrollViewport?.scrollToIndex(0),this.availableWords$.next(ae)})}),this.api.getDictionaries().subscribe(i=>this._dictionaries=i),this.crosswordDictionaryName$=this.selectedCrossword$.pipe((0,P.U)(i=>this._dictionaries.find(c=>c.id===i?.dictionaryId)?.name||"")),this.updateThemes()}get selectedThemeId(){return this.themesForm.get("theme")?.value}get selectedCrosswordId(){return this.crosswordsForm.get("crossword")?.value}get words(){return this._words}ngAfterViewInit(){this.nzTableComponent?.cdkVirtualScrollViewport?.scrolledIndexChange.pipe((0,u.t)(this),(0,I.h)(n=>{const t=this.availableWords$.value.length;return n>t-25&&t>=25&&!this._gridLoading}),(0,k.b)(()=>this._gridLoading=!0),(0,A.w)(()=>{const n=this.wordsForm.value;return this.api.getAvailableWords(this.selectedCrossword$.value?.dictionaryId,n.sort,n.search,n.mask,this.availableWords$.value[this.availableWords$.value.length-1].name)})).subscribe(n=>{this._gridLoading=!1,this.availableWords$.next([...this.availableWords$.value,...n])})}updateCrossword(n,t,s){this._words=[...s];const o=[];for(let i=0;i<n;i++)o[i]=new Array(t);for(const i of s)i.p1.x!==i.p2.x&&this.writeVerticalWord(o,i),i.p1.y!==i.p2.y&&this.writeHorizontalWord(o,i);this.crosswordMatrix$.next(o)}writeVerticalWord(n,t){for(let s=0;s<t.name.length;s++)n[t.p1.y][t.p2.x>t.p1.x?t.p1.x+s:t.p1.x-s]=t.name[s]}writeHorizontalWord(n,t){for(let s=0;s<t.name.length;s++)n[t.p2.y>t.p1.y?t.p1.y+s:t.p1.y-s][t.p1.x]=t.name[s]}cellClick(n,t){if(n!==this.selectedCell.y||t!==this.selectedCell.x){if(n===this.selectedCell.y||t===this.selectedCell.x)return this.selectedEndCell={y:n,x:t},void this.updateMask();this.selectedCell={y:n,x:t},this.selectedEndCell={y:null,x:null}}}updateMask(){const[n,t]=this.getFunctionalPoints(this.selectedCell,this.selectedEndCell);if(!n||!t)return;const s=[],o=this.crosswordMatrix$.value;if(null!==n.x&&null!==n.y&&null!==t.x&&null!==t.y){if(n.x===t.x)for(let c=0;c<=t.y-n.y;c++)s.push(o[n.y+c][n.x]);if(n.y===t.y)for(let c=0;c<=t.x-n.x;c++)s.push(o[n.y][n.x+c])}const i=s.map(c=>c??".").join("");this.wordsForm.get("mask")?.setValue(i)}cellDoubleclick(n,t){const s=(0,F.z)(this._words,t,n);if(1!==s.length)return;this._words=[...this._words.filter(a=>a.id!==s[0].id)];const o=this.selectedCrossword$.value;this.updateCrossword(o?.size.height??0,o?.size.width??0,this._words)}onAddTheme(){this.modal.create({nzContent:h,nzTitle:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u0435\u043c\u0443",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:n=>this.createTheme(n)})}createTheme(n){return new Promise(t=>{const s=n.form.value;this.api.createTheme(s.name).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u0422\u0435\u043c\u0430 ${s.name} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430`),this.updateThemes(),t(!0)},o=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",o.error.message),t(!0)})})}onEditTheme(){if(!this.selectedThemeId)return;const n=this.themes$.value.find(t=>t.id===this.selectedThemeId);this.modal.create({nzContent:h,nzComponentParams:{theme:n},nzTitle:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0442\u0435\u043c\u0443",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:t=>this.editTheme(t)})}editTheme(n){return new Promise(t=>{const s=n.form.value.name;this.api.putTheme(this.selectedThemeId,s).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u0422\u0435\u043c\u0430 ${s} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430`),this.updateThemes(),t(!0)},o=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",o.error.message),t(!0)})})}onDeleteTheme(){!this.selectedThemeId||this.api.deleteTheme(this.selectedThemeId).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u0422\u0435\u043c\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0430"),this.updateThemes(),this.themesForm.get("theme")?.setValue(null,{emitEvent:!1})},n=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",n.error.message)})}onAddCrossword(){this.modal.create({nzContent:p,nzComponentParams:{dictionaries:this._dictionaries,themes:this.themes$.value},nzTitle:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:n=>this.createCrossword(n)})}createCrossword(n){return new Promise(t=>{const s=n.form.value;s.words=[],this.api.createCrossword(s).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434 ${s.name} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d`),this.updateCrosswordsList(this.selectedThemeId),t(!0)},o=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",o.error.message),t(!0)})})}onEditCrossword(){if(!this.selectedCrossword$.value||!this.selectedCrosswordId)return;const n=this.selectedCrossword$.value;n.words=this._words,this.modal.create({nzContent:p,nzComponentParams:{dictionaries:this._dictionaries,themes:this.themes$.value,crossword:n},nzTitle:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434",nzOkText:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzWidth:420,nzOkDisabled:!0,nzOnOk:t=>this.editCrossword(t)})}editCrossword(n){return new Promise(t=>{const s=n.form.value,o=this.selectedCrossword$.value;s.words=o?.dictionaryId===s.dictionaryId&&o?.size.height===s.size.height&&o?.size.width===s.size.width&&o?.words||[],this.api.putCrossword(s,this.selectedCrosswordId).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434 ${s.name} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d`),this.updateCrosswordsList(this.selectedThemeId),this.selectedCrossword$.next(s),t(!0)},_=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",_.error.message),t(!0)})})}onDeleteCrosword(){!this.selectedCrossword$.value||!this.selectedCrosswordId||this.api.deleteCrossword(this.selectedCrosswordId).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445","\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d"),this.updateCrosswordsList(this.selectedThemeId),this.deselectCrossword()},n=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",n.error.message)})}onGenerateCrossword(){const n=this.selectedCrossword$.value,t=n?.size.width??0,s=n?.size.height??0;this.selectedCell={x:null,y:null},this.selectedEndCell={x:null,y:null},this.api.generateCrossword(t,s,n?.dictionaryId??0).subscribe(o=>{this.updateCrossword(s,t,o)},o=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",o.error.message)})}onSaveCrossword(){if(!this.selectedCrossword$.value||!this.selectedCrosswordId)return;const n={...this.selectedCrossword$.value,words:this._words};this.api.putCrossword(n,this.selectedCrosswordId).subscribe(()=>{this.notify.success("\u0423\u0441\u043f\u0435\u0445",`\u041a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434 ${n.name} \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d`)},t=>{this.notify.error("\u041e\u0448\u0438\u0431\u043a\u0430",t.error.message)})}trackByIndex(n,t){return t.id}onAvailableWordClick(n){if(!n||this._words.some(_=>_.id===n.id))return;const[t,s]=this.getFunctionalPoints(this.selectedCell,this.selectedEndCell);if(!t||!s)return;const o={id:n.id,definition:n.definition,name:n.name,p1:{x:t.x,y:t.y},p2:{x:s.x,y:s.y}};n.offset&&(o.p1.x===o.p2.x&&(o.p1.y+=n.offset),o.p1.y===o.p2.y&&(o.p1.x+=n.offset)),this._words.push(o),this._words=[...this._words];const i=this.selectedCrossword$.value;this.updateCrossword(i?.size.height??0,i?.size.width??0,this._words),this.updateMask()}updateThemes(){this.api.getThemes().subscribe(n=>this.themes$.next(n))}updateCrosswordsList(n){this.api.getCrosswordsList(n).subscribe(t=>this.crosswords$.next(t))}deselectCrossword(){this.selectedCell={x:null,y:null},this.selectedEndCell={x:null,y:null},this.crosswordsForm.get("crossword")?.setValue(null,{emitEvent:!1}),this.selectedCrossword$.next(null),this.crosswordMatrix$.next([[]])}getFunctionalPoints(n,t){return null===n.x||null===n.y||null===t.x||null===t.y?[null,null]:n.x===t.x?n.y<t.y?[n,t]:[t,n]:n.y===t.y?n.x<t.x?[n,t]:[t,n]:[null,null]}};C.\u0275fac=function(n){return new(n||C)(e.Y36(L.s),e.Y36(T.Sf),e.Y36(d.qu),e.Y36(N.zb))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-admin-crosswords"]],viewQuery:function(n,t){if(1&n&&e.Gf(V,5),2&n){let s;e.iGM(s=e.CRH())&&(t.nzTableComponent=s.first)}},decls:35,vars:23,consts:[[1,"themes",3,"formGroup"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0435\u043c\u0443","formControlName","theme"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-icon","","nzType","file-add","nzTheme","outline",3,"click"],["nz-icon","","nzType","edit","nzTheme","outline",3,"click"],["nz-icon","","nzType","delete","nzTheme","outline",1,"delete",3,"click"],["class","crossword-header",3,"formGroup",4,"ngIf"],["class","selected-crossword",4,"ngIf"],[1,"crossword-content"],["class","crossword-table","nzBordered","","nzTableLayout","fixed","nzSize","small",3,"width","nzData","nzShowPagination","nzFrontPagination",4,"ngIf"],[1,"filters",3,"formGroup"],[3,"nzPrefix"],["nz-input","","placeholder","\u041f\u043e\u0438\u0441\u043a","formControlName","search"],["suffixIconSearch",""],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443","formControlName","sort",1,"word-sort"],[1,"crossword-words"],[3,"nzData","nzFrontPagination","nzScroll","nzVirtualItemSize","nzVirtualForTrackBy",4,"ngIf"],[3,"nzData","nzScroll","nzShowPagination","nzFrontPagination"],["usedWordsTable",""],["nzWidth","160px"],[4,"ngFor","ngForOf"],[3,"nzLabel","nzValue"],[1,"crossword-header",3,"formGroup"],[1,"subsection"],["nzShowSearch","","nzPlaceHolder","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0440\u043e\u0441\u0441\u0432\u043e\u0440\u0434","formControlName","crossword"],["nz-icon","","nzType","plus","nzTheme","outline",3,"click"],[1,"selected-crossword"],[4,"ngIf"],[1,"crossword-buttons"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"click"],["nzBordered","","nzTableLayout","fixed","nzSize","small",1,"crossword-table",3,"nzData","nzShowPagination","nzFrontPagination"],["crosswordTable",""],["nzAlign","center",3,"selected","selected-potential","click","dblclick",4,"ngFor","ngForOf"],["nzAlign","center",3,"click","dblclick"],["nz-icon","","nzType","search",1,"search"],[3,"nzData","nzFrontPagination","nzScroll","nzVirtualItemSize","nzVirtualForTrackBy"],["availableWordsTable",""],["nz-virtual-scroll",""],[3,"click"]],template:function(n,t){if(1&n&&(e.TgZ(0,"section",0)(1,"nz-select",1),e.YNc(2,W,1,2,"nz-option",2),e.ALo(3,"async"),e.qZA(),e.TgZ(4,"span",3),e.NdJ("click",function(){return t.onAddTheme()}),e.qZA(),e.TgZ(5,"span",4),e.NdJ("click",function(){return t.onEditTheme()}),e.qZA(),e.TgZ(6,"span",5),e.NdJ("click",function(){return t.onDeleteTheme()}),e.qZA()(),e.YNc(7,q,11,4,"section",6),e.YNc(8,H,16,6,"section",7),e.ALo(9,"async"),e.TgZ(10,"section",8),e.YNc(11,R,5,8,"nz-table",9),e.ALo(12,"async"),e.TgZ(13,"section",10)(14,"h2"),e._uU(15,"\u0421\u043b\u043e\u0432\u0430"),e.qZA(),e.TgZ(16,"nz-input-group",11),e._UZ(17,"input",12),e.qZA(),e.YNc(18,ee,1,0,"ng-template",null,13,e.W1O),e.TgZ(20,"nz-select",14),e.YNc(21,te,1,2,"nz-option",2),e.qZA()(),e.TgZ(22,"section",15),e.YNc(23,se,10,6,"nz-table",16),e.ALo(24,"async"),e.TgZ(25,"nz-table",17,18)(27,"thead")(28,"tr")(29,"th",19),e._uU(30,"\u0421\u043b\u043e\u0432\u043e"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435"),e.qZA()()(),e.TgZ(33,"tbody"),e.YNc(34,oe,5,2,"tr",20),e.qZA()()()()),2&n){const s=e.MAs(19),o=e.MAs(26);e.Q6J("formGroup",t.themesForm),e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,14,t.themes$)),e.xp6(5),e.Q6J("ngIf",t.selectedThemeId),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,16,t.selectedCrossword$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(12,18,t.crosswordMatrix$)),e.xp6(2),e.Q6J("formGroup",t.wordsForm),e.xp6(3),e.Q6J("nzPrefix",s),e.xp6(5),e.Q6J("ngForOf",t.sortOptions),e.xp6(2),e.Q6J("ngIf",e.lcZ(24,20,t.availableWords$)),e.xp6(2),e.Q6J("nzData",t.words)("nzScroll",e.DdM(22,M))("nzShowPagination",!1)("nzFrontPagination",!1),e.xp6(9),e.Q6J("ngForOf",o.data)}},dependencies:[f.sg,f.O5,w.Ip,w.Vq,Z.Ls,d.Fj,d.JJ,d.JL,d.sg,d.u,g.Zp,g.gB,g.ke,m.N8,m.Uo,m._C,m.Om,m.p0,m.$Z,m.zu,m.UX,v.ix,B.w,D.dQ,f.Ov,Q.a,U],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.themes[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}nz-select[_ngcontent-%COMP%]{width:200px}span[nz-icon][_ngcontent-%COMP%]{font-size:24px;color:var(--cw-gray);cursor:pointer;transition:all .3s}span[nz-icon].search[_ngcontent-%COMP%]{font-size:16px;pointer-events:none}span[nz-icon].delete[_ngcontent-%COMP%]:hover{color:red}span[nz-icon][_ngcontent-%COMP%]:hover{color:var(--cw-primary)}.crossword-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-top:16px}.crossword-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.crossword-header[_ngcontent-%COMP%]   nz-input-group[_ngcontent-%COMP%]{width:166px}.crossword-header[_ngcontent-%COMP%]   .subsection[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.selected-crossword[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:16px}.selected-crossword[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin:0}.selected-crossword[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:400}.selected-crossword[_ngcontent-%COMP%]   .crossword-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-left:auto}.crossword-content[_ngcontent-%COMP%]{overflow:auto;margin-top:16px}nz-table.crossword-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px;height:31px}nz-table.crossword-table[_ngcontent-%COMP%]   td.selected[_ngcontent-%COMP%]{background-color:#44a4ff!important}nz-table.crossword-table[_ngcontent-%COMP%]   td.selected-potential[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#b1daff}.filters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:16px}.filters[_ngcontent-%COMP%]   nz-input-group[_ngcontent-%COMP%]{width:166px}.filters[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.crossword-words[_ngcontent-%COMP%]{display:flex;margin-top:8px}.crossword-words[_ngcontent-%COMP%]   nz-table[_ngcontent-%COMP%]{width:50%}"]}),C=(0,x.gn)([(0,u.c)()],C);var re=l(8176),ie=l(9444);const de=[{path:"",component:C}];let le=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[f.ez,re.Bz.forChild(de),w.LV,Z.PV,d.UX,d.u5,g.o7,m.HQ,v.sL,ie.D]}),r})()}}]);